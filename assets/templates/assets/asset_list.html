{% extends 'base.html' %}
{% load humanize %}

{% block title %}Inventory Aset{% endblock %}
{% block subtitle %}Kelola database seluruh aset IT.{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div class="d-flex gap-2">
        <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2 rounded-pill border border-primary-subtle">
            <i class="bi bi-box-seam me-1"></i> Total Data: {{ assets.paginator.count }} Unit
        </span>
    </div>
    <div class="d-flex gap-2">
        <a href="{% url 'asset_create' %}" class="btn btn-primary rounded-pill px-4 shadow-sm">
            <i class="bi bi-plus-lg me-1"></i> Tambah Aset
        </a>
    </div>
</div>

<div class="card border-0 shadow-sm mb-4">
    <div class="card-body p-3">
        <form id="filter-form" method="get" action="." class="row g-2" 
              hx-get="{% url 'asset_list' %}?page=1" 
              hx-target="#asset-table-body" 
              hx-swap="innerHTML" 
              hx-push-url="true"
              hx-indicator=".htmx-indicator"
              hx-trigger="change, submit, keyup delay:500ms from:input[name='q'], refreshTable from:body">
            
            <input type="hidden" name="sort" value="{{ sort_current }}">
            
            <div class="col-md-2">
                <select name="category" class="form-select border-0 bg-light fw-medium text-secondary">
                    <option value="">Semua Kategori</option>
                    {% for cat in kategori_list %}
                        <option value="{{ cat.id }}" {% if category_filter == cat.id|stringformat:"s" %}selected{% endif %}>
                            {{ cat.nama }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2">
                <select name="location" class="form-select border-0 bg-light fw-medium text-secondary">
                    <option value="">Semua Lokasi</option>
                    {% for loc in lokasi_list %}
                        <option value="{{ loc.id }}" {% if location_filter == loc.id|stringformat:"s" %}selected{% endif %}>
                            {{ loc.nama }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2">
                <select name="status" class="form-select border-0 bg-light fw-medium text-secondary">
                    <option value="">Semua Status</option>
                    {% for code, label in status_choices %}
                        <option value="{{ code }}" {% if status_filter == code %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md">
                <div class="input-group">
                    <span class="input-group-text border-0 bg-light text-muted ps-3">
                        <i class="bi bi-search"></i>
                    </span>
                    <input type="text" name="q" value="{{ query|default:'' }}" 
                           class="form-control border-0 bg-light" 
                           placeholder="Cari nama, SN, user..." autocomplete="off">
                </div>
            </div>
            
            <div class="htmx-indicator spinner-border spinner-border-sm text-primary ms-2 my-auto" role="status"></div>
        </form>
    </div>
</div>

<div id="asset-table-body" class="card border-0 shadow-sm overflow-hidden fade-in">
    {% include 'assets/asset_table_partial.html' %}
</div>

<div id="modal-container" class="modal fade" tabindex="-1" aria-hidden="true">
    <div id="modal-content" class="modal-dialog modal-dialog-centered" style="max-width: 400px;">
        </div>
</div>

<style>
    body.modal-open #asset-table-body, 
    body.modal-open .card-body,
    body.modal-open .d-flex {
        filter: blur(4px);
        transition: filter 0.3s ease;
    }
    .modal-backdrop.show {
        opacity: 0.7;
        background-color: #000;
        backdrop-filter: blur(2px);
    }
</style>

<script>
    document.body.addEventListener('closeModal', function() {
        var modalEl = document.getElementById('modal-container');
        var modalInstance = bootstrap.Modal.getInstance(modalEl);
        if (modalInstance) {
            modalInstance.hide();
        }
    });

    document.body.addEventListener('htmx:afterSwap', function(evt) {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    });
</script>
{% endblock %}