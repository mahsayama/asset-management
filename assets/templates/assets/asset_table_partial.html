{% load humanize %}

<div class="table-responsive">
    <table class="table table-hover align-middle text-start mb-0">
        <thead class="bg-light">
            <tr hx-target="#asset-table-body" hx-push-url="true" hx-include="#filter-form">
                <th class="ps-4 pointer" style="cursor:pointer"
                    hx-get="?sort={% if sort_current == 'name' %}-name{% else %}name{% endif %}">
                    Nama Aset 
                    {% if sort_current == 'name' %}<i class="bi bi-sort-alpha-down"></i>
                    {% elif sort_current == '-name' %}<i class="bi bi-sort-alpha-up-alt"></i>
                    {% else %}<i class="bi bi-arrow-down-up opacity-50"></i>{% endif %}
                </th>
                
                <th>Barcode / SN</th>            
                <th class="d-none d-md-table-cell">Kategori</th>
                <th class="d-none d-md-table-cell">Lokasi</th>
                <th>User / Dept</th>
                
                <th class="d-none d-xl-table-cell">Prev. User & Dept</th> 
                
                <th class="pointer" style="cursor:pointer"
                    hx-get="?sort={% if sort_current == 'status' %}-status{% else %}status{% endif %}">
                    Status
                </th>

                <th class="d-none d-lg-table-cell">Harga</th>

                <th class="text-center pointer" style="min-width: 120px; cursor:pointer"
                    hx-get="?sort={% if sort_current == '-created_at' %}created_at{% else %}-created_at{% endif %}">
                    Aksi
                </th> 
            </tr>
        </thead>
        <tbody>
            {% for asset in assets %}
            <tr>
                <td class="ps-4">
                    <div class="fw-bold text-dark">{{ asset.name|truncatechars:30 }}</div>
                    <small class="text-muted d-block d-md-none font-monospace mt-1">{{ asset.serial_number }}</small>
                </td>
                <td>
                    {% if asset.barcode_id %}
                        <div class="badge bg-light text-dark border mb-1 font-monospace" style="font-size: 0.75rem;">{{ asset.barcode_id }}</div>
                    {% endif %}
                    <div class="small text-muted font-monospace d-none d-md-block">{{ asset.serial_number }}</div>
                </td>
                <td class="d-none d-md-table-cell text-muted small">{{ asset.kategori.nama|default:"-" }}</td>
                <td class="d-none d-md-table-cell text-muted small">{{ asset.lokasi.nama|default:"-" }}</td>
                <td>
                    <div class="fw-medium text-dark">{{ asset.current_user|default:"-" }}</div>
                    <small class="text-muted d-block" style="font-size: 0.75rem;">{{ asset.current_dept|default:"" }}</small>
                </td>

                <td class="d-none d-xl-table-cell small text-muted">
                    {% if asset.prev_user %}
                        <div class="d-flex align-items-center mb-1" style="font-size: 0.72rem;">
                            <i class="bi bi-person-dash me-1 text-secondary"></i> {{ asset.prev_user }}
                        </div>
                        <div class="d-flex align-items-center" style="font-size: 0.72rem;">
                            <i class="bi bi-building me-1 text-secondary"></i> {{ asset.prev_dept|default:"-" }}
                        </div>
                    {% else %}
                        <span class="opacity-50">â€”</span>
                    {% endif %}
                </td>

                <td>
                    {% if asset.status == 'TERSEDIA' %}
                        <span class="badge bg-success bg-opacity-10 text-success border border-success-subtle rounded-pill px-3 py-1 fw-medium">Tersedia</span>
                    {% elif asset.status == 'DIPAKAI' %}
                        <span class="badge bg-primary bg-opacity-10 text-primary border border-primary-subtle rounded-pill px-3 py-1 fw-medium">Dipakai</span>
                    {% elif asset.status == 'RUSAK' %}
                        <span class="badge bg-danger bg-opacity-10 text-danger border border-danger-subtle rounded-pill px-3 py-1 fw-medium">Rusak</span>
                    {% else %}
                        <span class="badge bg-warning bg-opacity-10 text-dark border border-warning-subtle rounded-pill px-3 py-1 fw-medium">Hilang</span>
                    {% endif %}
                </td>
                <td class="d-none d-lg-table-cell font-monospace fw-medium text-dark">
                    Rp {{ asset.price|intcomma|default:"0" }}
                </td>
                <td class="text-center">
                    <div class="d-flex justify-content-center gap-2">
                        <a href="{% url 'asset_detail' asset.pk %}" class="text-primary" title="Detail" data-bs-toggle="tooltip">
                            <i class="bi bi-eye fs-5"></i>
                        </a>
                        <a href="{% url 'asset_update' asset.pk %}" class="text-warning" title="Edit" data-bs-toggle="tooltip">
                            <i class="bi bi-pencil-square fs-5"></i>
                        </a>
                        
                        <button hx-get="{% url 'asset_delete' asset.pk %}" 
                                hx-target="#modal-content" 
                                class="btn btn-link text-danger p-0 border-0" 
                                style="text-decoration: none;"
                                data-bs-toggle="modal" 
                                data-bs-target="#modal-container"
                                title="Hapus">
                            <i class="bi bi-trash fs-5"></i>
                        </button>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9" class="text-center py-5">
                    <div class="mb-3 text-muted opacity-25"><i class="bi bi-inbox" style="font-size: 3rem;"></i></div>
                    <h6 class="fw-bold text-dark">Data Tidak Ditemukan</h6>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if assets.has_other_pages %}
<div class="d-flex justify-content-between align-items-center p-3 border-top bg-white">
    <small class="text-muted">Hal {{ assets.number }} dari {{ assets.paginator.num_pages }}</small>
    <div class="btn-group">
        {% if assets.has_previous %}
        <button class="btn btn-sm btn-outline-secondary" hx-get="?page={{ assets.previous_page_number }}" hx-include="#filter-form" hx-target="#asset-table-body" hx-push-url="true" hx-swap="innerHTML">
            <i class="bi bi-chevron-left"></i> Prev
        </button>
        {% endif %}
        {% if assets.has_next %}
        <button class="btn btn-sm btn-outline-secondary" hx-get="?page={{ assets.next_page_number }}" hx-include="#filter-form" hx-target="#asset-table-body" hx-push-url="true" hx-swap="innerHTML">
            Next <i class="bi bi-chevron-right"></i>
        </button>
        {% endif %}
    </div>
</div>
{% endif %}

<script>
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })
</script>